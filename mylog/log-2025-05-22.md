# Log â€” 2025-05-22

## SSR `window is not defined` Error: Root Cause & Solution

### Problem
- The app was failing to build due to a `window is not defined` error during SSR (server-side rendering).
- The root cause was importing a browser-only library (`react-apexcharts`/`apexcharts` via `CandlestickCard`) somewhere in the `/search/page.tsx` import chain.
- Even with `"use client"` on components, Next.js can still attempt to evaluate the import chain for SSR/prerendering, causing this error.

### What We Did
1. **Identified the Import Chain:**  
   Traced all imports from `/search/page.tsx` down to `CandlestickCard` and ensured all relevant files were marked as client components with `"use client"`.
2. **Dynamic Import Fix:**  
   Switched to using Next.js dynamic import for `CandlestickCard` with `ssr: false`:
   ```tsx
   import dynamic from "next/dynamic";
   const CandlestickCard = dynamic(() => import("../common/CandlestickCard"), { ssr: false });
   ```
   This ensures the chart is only loaded and rendered on the client, never during SSR.
3. **Verified Build & Local Dev:**  
   - The build now completes successfully.
   - The app runs locally and the Candlestick chart renders as expected.

### Best Practice Going Forward
- **Always use dynamic import with `ssr: false` for any component that depends on browser-only libraries or APIs.**
- Mark all files in the import chain as `"use client"` if they use browser-only code or React client hooks.

---

**Result:**  
SSR errors are resolved, the app builds and runs locally, and the Candlestick chart is safely rendered client-side. 